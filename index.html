<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Interactive Zoom Gallery — Demo</title>
<meta name="description" content="Interaktive Startseite mit Zoom zu 3D-Produkten (three.js + GSAP)" />
<style>
  :root{
    --bg:#fbfdff;
    --panel:rgba(11,107,90,0.95);
    --muted:#6b7280;
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  }
  html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#eef6f7);overflow:hidden}
  #canvas-container{position:fixed;inset:0}
  /* minimal overlay UI */
  .ui {
    position:fixed;left:24px;top:24px;z-index:50;display:flex;gap:12px;align-items:center;
    backdrop-filter: blur(6px);padding:8px 12px;border-radius:10px;
    background:rgba(255,255,255,0.6);box-shadow:0 6px 20px rgba(12,20,30,0.08)
  }
  .logo{height:36px;font-weight:800;color:#0b6b5a}
  .cta {margin-left:auto;background:#0b6b5a;color:#fff;padding:8px 12px;border-radius:8px;text-decoration:none;font-weight:700}
  /* product card */
  .card {
    position:fixed;right:24px;bottom:24px;z-index:60;width:320px;padding:14px;border-radius:12px;
    background:linear-gradient(180deg,rgba(255,255,255,0.98),rgba(245,249,249,0.95));
    box-shadow:0 12px 40px rgba(4,12,18,0.12);display:none;
  }
  .card h3{margin:0;font-size:18px;color:#07231f}
  .card p{margin:8px 0 0;color:var(--muted);font-size:14px}
  .close-btn{margin-top:12px;background:#0b6b5a;color:#fff;padding:8px;border-radius:8px;border:0;cursor:pointer}
  /* small help text */
  .hint{position:fixed;left:50%;bottom:12px;transform:translateX(-50%);z-index:40;background:rgba(0,0,0,0.6);color:#fff;padding:6px 10px;border-radius:999px;font-size:13px}
  /* loader */
  #loader {position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);z-index:80;padding:8px 12px;border-radius:8px;background:#0b6b5a;color:#fff;display:none}
</style>
</head>
<body>
  <div id="canvas-container"></div>

  <div class="ui">
    <div class="logo">AutoTalk AI</div>
    <a class="cta" href="#kontakt">Jetzt anfragen</a>
  </div>

  <div id="loader">Lädt 3D-Modell…</div>

  <div class="card" id="productCard" role="dialog" aria-hidden="true">
    <h3 id="pcTitle">Produkt</h3>
    <p id="pcDesc">Beschreibung</p>
    <button class="close-btn" id="cardClose">Schließen</button>
  </div>

  <div class="hint">Klicke auf einen Punkt, um reinzuzoomen</div>

  <!-- three.js + loaders + GSAP (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.156.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.156.0/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.156.0/examples/js/loaders/GLTFLoader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.0/dist/gsap.min.js"></script>

  <script>
  /* ---------- Setup Szene, Kamera, Renderer ---------- */
  const container = document.getElementById('canvas-container');
  const scene = new THREE.Scene();
  scene.fog = new THREE.FogExp2(0xeef6f7, 0.02);

  const renderer = new THREE.WebGLRenderer({antialias:true, alpha:true});
  renderer.setPixelRatio(window.devicePixelRatio);
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.outputEncoding = THREE.sRGBEncoding;
  container.appendChild(renderer.domElement);

  const camera = new THREE.PerspectiveCamera(45, innerWidth/innerHeight, 0.1, 1000);
  camera.position.set(0, 6, 18);

  const controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;
  controls.rotateSpeed = 0.4;
  controls.minDistance = 2;
  controls.maxDistance = 80;

  // light
  const amb = new THREE.AmbientLight(0xffffff, 0.9); scene.add(amb);
  const dir = new THREE.DirectionalLight(0xffffff, 0.6); dir.position.set(5,10,7); scene.add(dir);

  /* ---------- Sterne/Punkte als Klick-Targets ---------- */
  const pointsGroup = new THREE.Group();
  scene.add(pointsGroup);

  // sample "products" (position, label, modelPath)
  const PRODUCTS = [
    {id: 'p1', pos: new THREE.Vector3(-6,1.5,-8), title:'Chatbot Basic', desc:'Individuell & monatlich kündbar — 150€/Monat', model:'assets/models/model1.glb'},
    {id: 'p2', pos: new THREE.Vector3(5,2,-5), title:'Chatbot + Website', desc:'inkl. Website-Erstellung — 300€/Monat', model:'assets/models/model2.glb'}
  ];

  // small sprite for each product
  const spriteMaterial = new THREE.SpriteMaterial({ color: 0x00a079 });
  PRODUCTS.forEach((p,i)=>{
    const sp = new THREE.Sprite(spriteMaterial.clone());
    sp.material.sizeAttenuation = true;
    sp.scale.set(0.8,0.8,0.8);
    sp.position.copy(p.pos);
    sp.userData = { productIndex: i };
    pointsGroup.add(sp);
  });

  /* ---------- Raycaster (zum Klicken) ---------- */
  const raycaster = new THREE.Raycaster();
  const mouse = new THREE.Vector2();

  function onClick(e){
    const rect = renderer.domElement.getBoundingClientRect();
    mouse.x = ((e.clientX - rect.left) / rect.width) * 2 - 1;
    mouse.y = -((e.clientY - rect.top) / rect.height) * 2 + 1;
    raycaster.setFromCamera(mouse, camera);
    const hits = raycaster.intersectObjects(pointsGroup.children, true);
    if(hits.length>0){
      const hit = hits[0].object;
      const idx = hit.userData.productIndex;
      if(idx !== undefined) openProduct(idx);
    }
  }
  renderer.domElement.addEventListener('pointerdown', onClick, false);

  /* ---------- 3D Modell laden & Zoom Animation ---------- */
  const loader = new THREE.GLTFLoader();
  let currentModel = null;
  const loaderOverlay = document.getElementById('loader');

  function showLoader(show){ loaderOverlay.style.display = show ? 'block' : 'none' }

  function openProduct(index){
    const product = PRODUCTS[index];
    showLoader(true);
    // Kamera zoom/tween auf position nahe des product point
    const target = {x: product.pos.x, y: product.pos.y, z: product.pos.z};
    // Zielkamera-Position: etwas in front
    const newCam = { x: product.pos.x, y: product.pos.y + 1.2, z: product.pos.z + 3.5 };

    gsap.to(camera.position, {
      duration: 1.1,
      x: newCam.x, y: newCam.y, z: newCam.z,
      ease: "power2.inOut",
      onUpdate: function(){ camera.lookAt(product.pos); }
    });

    // lade Modell (falls vorhanden)
    if(currentModel){ scene.remove(currentModel); currentModel = null; }
    loader.load(product.model, gltf => {
      currentModel = gltf.scene;
      currentModel.position.copy(product.pos);
      // scale to sensible size:
      currentModel.scale.setScalar(1.0);
      scene.add(currentModel);
      showLoader(false);
      showCard(product.title, product.desc);
    }, undefined, err => {
      console.error('Modell-Ladefehler:', err);
      showLoader(false);
      showCard(product.title, product.desc + ' (Modell konnte nicht geladen werden)');
    });
  }

  /* ---------- UI: Produktkarte zeigen / schließen ---------- */
  const card = document.getElementById('productCard');
  const pcTitle = document.getElementById('pcTitle');
  const pcDesc = document.getElementById('pcDesc');
  document.getElementById('cardClose').addEventListener('click', ()=>{
    card.style.display='none';
    // optional: zurückzoomen
    gsap.to(camera.position, {duration:1.0, x:0, y:6, z:18, ease:"power2.inOut"});
  });

  function showCard(title, desc){
    pcTitle.textContent = title;
    pcDesc.textContent = desc;
    card.style.display = 'block';
    card.setAttribute('aria-hidden', 'false');
  }

  /* ---------- Animation Loop ---------- */
  function animate(){
    requestAnimationFrame(animate);
    // subtle rotation of the whole star group for effect
    pointsGroup.rotation.y += 0.0008;
    controls.update();
    renderer.render(scene, camera);
  }
  animate();

  /* ---------- Resize ---------- */
  window.addEventListener('resize', ()=>{
    camera.aspect = innerWidth/innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(innerWidth, innerHeight);
  });

  // optional: initial gentle zoom animation on load
  gsap.from(camera.position, {duration:1.6, z:30, ease:"power2.out"});
  </script>
</body>
</html>
